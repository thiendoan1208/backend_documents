> tip: shift + enter : xuá»‘ng dÃ²ng

MongoDB BÃ i 1 - KhÃ¡i Niá»‡m CÆ¡ Sá»Ÿ Dá»¯ Liá»‡u (SQL VÃ  NoSQL)

Â 
Â 	1. MongoDB (NoSQL)
Â 
Â 	+ Dá»¯ liá»‡u dáº¡ng document(JSON)
Â 	+ linh hoáº¡t, k cáº§n schema
Â 	+ khÃ´ng há»— trá»£ join truyá»n thá»‘ng
Â 	+ tá»‘t cho dá»¯ liá»‡u phi cáº¥u trÃºc
Â 	+ linh hoáº¡t, dá»… scale


Â 	2. MySQL (SQL)

Â 	+ Dá»¯ liá»‡u dáº¡ng báº£ng
Â 	+ cáº§n schema cá»‘ Ä‘á»‹nh
Â 	+ há»— trá»£ join máº¡nh
Â 	+ tá»‘t cho dá»¯ liá»‡u quan há»‡
Â 	+ tuÃ¢n thá»§ ACID

ðŸ”¹ NÃªn dÃ¹ng khi nÃ o?

MySQL: App tÃ i chÃ­nh, CRM, ERP, cáº§n JOIN vÃ  tÃ­nh chÃ­nh xÃ¡c cao.

MongoDB: Social app, MVP, dá»¯ liá»‡u linh hoáº¡t, scale lá»›n, cáº§n phÃ¡t triá»ƒn nhanh, hiá»‡u suáº¥t tá»‘c Ä‘á»™ cao.


VÃ­ dá»¥ dá»± Ã¡n phÃ¹ há»£p SQL:

Há»‡ thá»‘ng ngÃ¢n hÃ ng, káº¿ toÃ¡n (quan há»‡ phá»©c táº¡p, cáº§n tÃ­nh chÃ­nh xÃ¡c).

Website thÆ°Æ¡ng máº¡i Ä‘iá»‡n tá»­ (quáº£n lÃ½ sáº£n pháº©m, khÃ¡ch hÃ ng, Ä‘Æ¡n hÃ ng).

á»¨ng dá»¥ng quáº£n lÃ½ trÆ°á»ng há»c (lá»›p há»c, sinh viÃªn, Ä‘iá»ƒm sá»‘).

Báº¥t cá»© app nÃ o mÃ  tÃ­nh nháº¥t quÃ¡n dá»¯ liá»‡u lÃ  sá»‘ 1.


VÃ­ dá»¥ dá»± Ã¡n phÃ¹ há»£p NoSQL:

Máº¡ng xÃ£ há»™i (bÃ i Ä‘Äƒng, bÃ¬nh luáº­n, likeâ€¦ lÆ°u dáº¡ng document).

Realtime chat (WebSocket + MongoDB/Redis).

Há»‡ thá»‘ng log, analytics, tracking (dá»¯ liá»‡u khá»•ng lá»“, cáº§n lÆ°u nhanh).

Game online (tráº¡ng thÃ¡i ngÆ°á»i chÆ¡i, leaderboardâ€¦).



MongoDB BÃ i 2 - CÃ i Äáº·t Nhá»¯ng ChÆ°Æ¡ng TrÃ¬nh Cáº§n Thiáº¿t Cho KhÃ³a Há»c

Â 	Cáº§n táº£i nhá»¯ng thá»© cáº§n thiáº¿t sau:

Â 		+ MongoDB community server
Â 		+ MongoDB Shell

Â 
Â 	Check download Ä‘Æ°á»£c chÆ°a

Â 		cmd > mongosh




MongoDB BÃ i 3 - KhÃ¡i Niá»‡m SÆ°u Táº­p VÃ  TÃ i Liá»‡u

Â 	1. CÃ¡ch mongodb chá»©a dá»¯ liá»‡u

Â 		+ MongoDB chá»©a dá»¯ liá»‡u sáº½ bao gá»“m nhiá»u bá»™ sÆ°u táº­p (collection)

Â 		+ Má»—i bá»™ sÆ°u táº­p sáº½ cÃ³ nhiá»u tÃ i liá»‡u khÃ¡c nhau	(document)
Â 
Â 		+ Khi gá»i 1 tÃ iu liá»‡u cá»¥ thá»ƒ trong bá»™ sÆ°u táº­p, sáº½ cho vá» dáº¡ng BSON ( nhá»‹ phÃ¢n cá»§a JSON )

Â 		+ Má»—i má»™t dá»¯ liá»‡u BSON sáº½ cÃ³ 1 ID riÃªng biá»‡t Ä‘á»ƒ phÃ¢n biá»‡t
Â 
Â 		+ Má»™t tÃ i liá»‡u cÃ³ thá»ƒ sáº½ cÃ³ 1 tÃ i liá»‡u khÃ¡c nhá» hÆ¡n cháº»n vÃ o ( tÃ i liá»‡u lá»“ng tÃ i liá»‡u )

Â 
Â 	MongoDB > Collection1, Collection2 > Document1, Document2,..



MongoDB BÃ i 4 - CÃ¡ch Sá»­ Dá»¥ng CÃ´ng Cá»¥ MongoDB Compass

Â 	+ CÃ´ng cá»¥ nÃ y sáº½ giÃºp chÃºng ta tao vÃ  káº¿t ná»‘i Ä‘áº¿n db, crud dá»¯ee liá»‡u

Â 	+ MongoDB Compass lÃ  giao diá»‡n Ä‘á»“ há»a chÃ­nh thá»©c cá»§a MongoDB, giÃºp báº¡n lÃ m viá»‡c vá»›i cÆ¡ sá»Ÿ dá»¯ liá»‡u mÃ  khÃ´ng cáº§n nhá»› cÃº phÃ¡p lá»‡nh.

Â 	+ NÃ³i nÃ´m na, nÃ³ lÃ  "Excel" cá»§a MongoDB â€” báº¡n click chuá»™t, kÃ©o tháº£, lá»c dá»¯ liá»‡u trá»±c quan thay vÃ¬ gÃµ lá»‡nh.


Â 	. Káº¿t ná»‘i MongoDB vÃ  mÃ¡y chá»§

Â 		+ Add new connection > save connect

Â 


MongoDB BÃ i 5 - CÃ¡ch Sá»­ Dá»¥ng CÃ´ng Cá»¥ MongoDB Shell

Â 	+ mongosh (MongoDB Shell) lÃ  cÃ´ng cá»¥ dÃ²ng lá»‡nh chÃ­nh thá»©c cá»§a MongoDB, dÃ¹ng Ä‘á»ƒ tÆ°Æ¡ng tÃ¡c trá»±c tiáº¿p vá»›i cÆ¡ sá»Ÿ dá»¯ liá»‡u MongoDB.

Â 	+ nÆ¡i báº¡n cÃ³ thá»ƒ:

Káº¿t ná»‘i tá»›i server MongoDB (local hoáº·c remote).

GÃµ lá»‡nh CRUD (Create, Read, Update, Delete) Ä‘á»ƒ lÃ m viá»‡c vá»›i dá»¯ liá»‡u.

Quáº£n lÃ½ collection, database, user, index, v.vâ€¦

Thá»±c thi JavaScript trá»±c tiáº¿p Ä‘á»ƒ thao tÃ¡c dá»¯ liá»‡u.


ðŸ” So sÃ¡nh nhanh

| TiÃªu chÃ­                  | **mongosh** (Command Line)                                 | **MongoDB Compass** (GUI)                                      |
| ------------------------- | ---------------------------------------------------------- | -------------------------------------------------------------- |
| **CÃ¡ch sá»­ dá»¥ng**          | GÃµ lá»‡nh báº±ng tay                                           | DÃ¹ng giao diá»‡n trá»±c quan                                       |
| **Tá»‘c Ä‘á»™ thao tÃ¡c**       | Nhanh náº¿u thuá»™c lá»‡nh                                       | Nhanh vá»›i ngÆ°á»i má»›i hoáº·c khi cáº§n xem dá»¯ liá»‡u trá»±c quan         |
| **TÃ­nh nÄƒng nÃ¢ng cao**    | CÃ³ thá»ƒ cháº¡y script, automation, query phá»©c táº¡p, admin task | Há»— trá»£ filter, sort, aggregation cÆ¡ báº£n, xem dá»¯ liá»‡u trá»±c quan |
| **Cáº§n nhá»› cÃº phÃ¡p**       | âœ… Báº¯t buá»™c                                                 | âŒ KhÃ´ng cáº§n                                                    |
| **Trá»±c quan hoÃ¡ dá»¯ liá»‡u** | âŒ KhÃ´ng cÃ³                                                 | âœ… CÃ³ (biá»ƒu Ä‘á»“, schema)                                         |
| **Debug & DevOps**        | âœ… Ráº¥t tá»‘t, phÃ¹ há»£p khi SSH vÃ o server                      | âŒ KhÃ´ng tiá»‡n náº¿u Ä‘ang lÃ m viá»‡c trÃªn terminal                   |
| **CÃ i Ä‘áº·t**               | Nháº¹, chá»‰ cáº§n terminal                                      | Náº·ng hÆ¡n, cáº§n GUI                                              |
| **TÃ­ch há»£p CI/CD**        | âœ… CÃ³ thá»ƒ dÃ¹ng script mongosh trong pipeline                | âŒ KhÃ´ng há»— trá»£ trá»±c tiáº¿p                                       |



> ÄÆ¡n giáº£n mÃ  nÃ³i mongosh chÃ­nh lÃ  client, mongoDBCompass chÃ­nh server

Â 	. CÃ³ thá»ƒ khá»Ÿi táº¡o trá»±c tiáº¿p qua mongoDB Compass = cÃ¡ch chá»n open mongoshel

Â 	. hoáº·c sá»­ dá»¥ng qua terminal > mongosh

Â 
Â 	* Má»™t sá»‘ lá»‡nh cÆ¡ báº£n nhÆ°:

Â 		+ show dbs
Â 		+ use db
Â 		+ exit
Â 
Â 		+ db.createCollection("name") > táº¡o collection

Â 	> mongodb hoÃ n toÃ n cho phÃ©p sá»­ dá»¥ng 1 db chÆ°a tá»“n táº¡i

Â 	> káº¿t ná»‘i Ä‘áº¿n 1 db nháº¥t Ä‘á»‹nh: mongosh "mongodb://root:example@localhost:27018/" --username root --authenticationDatabase admin
Â 



MongoDB BÃ i 6 - ThÃªm, xÃ³a TÃ i Liá»‡u Bá»™ SÆ°u Táº­p Báº±ng MongoDB Shell


Â Chá»n db

Â 	* ThÃªm

Â 	2. db.collection.insertOne(data) > 1 data
Â 
Â 	3. db.collection.insertMany([many_obj_data]) > máº£ng nhiá»ƒu obj data


Â 	* xÃ³a

Â 	1. db.collection.drop() > XÃ³a collection

Â 	2. db.collection.deleteOne() > xÃ³a 1 doc

Â 	3. db.collection.deleteMany() > xÃ³a nhiá»u docs

Â 
Â 	* ta hoÃ n toÃ n cÃ³ thá»ƒ sá»­ dá»¥ng lá»‡nh insert vá»›i collection chÆ°a tá»“n táº¡i vÃ¬ nÃ³ sáº½ tá»± Ä‘á»™ng thÃªm vÃ o db

Â 


MongoDB BÃ i 7 - CÃ¡ch TÃ¬m VÃ  Lá»c TÃ i Liá»‡u Trong MongoDB Shell

Â 	> "Ä‘Æ¡n" : k cáº§n ""
Â 	> "a.v.v": cáº§n ""

Â 	* TÃ¬m doc trong collection

Â 	1. db.collection.find() > tÃ¬m táº¥t cáº£ vÃ  tráº£ vá»


Â 	2. db.collection.find({sort_data}) > tÃ¬m tráº£ vá» theo tiÃªu chÃ­ . VD: find({"name": "Thien"})

Â 
Â 	3. db.collection.find({sort_data}, {taken_out_data}) > TÃ¬m vÃ  tráº£ vá» theo tiÃªu chÃ­ ngoÃ i ra cÃ²n lá»c xem tráº£ vá» nhá»¯ng gÃ¬ trong obj há»£p lá»‡
Â 
Â 								VD: find({"name":"thien"}, {id: 1, type: 1}) > sá»‘ biá»ƒu thá»‹ cho trÆ°á»ng, 0 lÃ  bá»


Â 	4. db.collection.findOne({sort_data})  > tráº£ vá» 1 result duy nháº¥t



MongoDB BÃ i 8 - Sáº¯p Xáº¿p VÃ  Giá»›i Háº¡n Dá»¯ Liá»‡u


Â 	1. db.collection.count() > Ä‘áº¿m tá»•ng tÃ i liá»‡u

Â 	2. db.collection.find(<query>).limit(<number>) > giá»›i háº¡n danh sÃ¡ch tráº£ vá»


Sáº¯p xáº¿p

Â 	3. db.collection.sort({title: 1}).limit(number) > Sáº¯p xáº¿p theo thá»© tá»± tÃ¹y vÃ o thuá»™c tÃ­nh Ä‘áº·t

Â 		. 1 - TÄƒng dáº§n

Â 		. -1 - Giáº£m dáº§n

Â 

MongoDB BÃ i 9 - Táº¡o TÃ i Liá»‡u Lá»“ng TÃ i Liá»‡u


Â 	+ ÄÆ¡n giáº£n chá»‰ lÃ  1 obj trong 1 obj khÃ¡c :)

{
Â  "_id": "66bb1b3f8c2d4a5f1b2c9d1a",
Â  "title": "Neon Skies",
Â  "genre": "Action",
Â  "releaseYear": 2022,
Â  "rating": 8.8,
Â  "isAvailable": true,
Â  "details": {
Â    "duration": 125,
Â    "director": {
Â      "name": "Liam Stone",
Â      "birthYear": 1980,
Â      "nationality": "Canada"
Â    },
Â    "production": {
Â      "company": "Skyline Pictures",
Â      "country": "USA"
Â    }
Â  }
}

ðŸ“Œ Trong vÃ­ dá»¥ nÃ y:

details lÃ  má»™t document bÃªn trong doc chÃ­nh.

director vÃ  production láº¡i lÃ  nested document bÃªn trong details.

Â 
+ CÃ¡ch truy váº¥n vÃ o nested document.
Â 

VÃ­ dá»¥ láº¥y táº¥t cáº£ phim do Liam Stone Ä‘áº¡o diá»…n:
db.movies.find({ "details.director.name": "Liam Stone" })


Â 	* Lá»£i Ã­ch:

Â 		+ Chá»‰ cáº§n dÃ¹ng khi truy váº¥n lÃ  Ä‘Ã£ cÃ³ táº¥t cáº£ cÃ¡c thÃ´ng tin
Â 		+ Hoáº·c khi bá»™ sÆ°u táº­p trá»Ÿ lÃªn quÃ¡ lá»›n, chá»‰ cáº§n tráº£ vá» nhá»¯ng tÃ i liá»‡u trÃªn Ä‘áº§u




MongoDB BÃ i 10 - Nhá»¯ng Bá»™ Lá»c NÃ¢ng Cao

Â 	1. $gt (greater than), $lt (less than), $gte (greater than or equal), $lte (less than or equal)

Â 	VD: db.books.find({rating: {$gt : 7} })  > Ä‘á»ƒ trong dáº¥u {}
Â 	    db.books.find({"rating": {$lt: 1}, "name": "abc" })


Â 	2. $or (1 trong 2 Ä‘iá»u kiá»‡n Ä‘Ãºng), $and :cáº£ 2 Ä‘á»u Ä‘Ãºng cÃ¡ch viáº¿t cÅ©ng tÆ°Æ¡ng tá»±


Â 	VD: db.books.find([{rating: 7}, {rating :9}]) > chá»‰ cáº§n 1 trong 2 Ä‘iá»u kiá»‡n thá»a mÃ£n



MongoDB BÃ i 11 - Tá»« KhÃ³a Lá»c Trong VÃ  KhÃ´ng Trong

Â 
Â 	1. $in , $nin
Â 
Â 	VD:  db.books.find({"rating": {$in: [7, 8, 9]}}) > tráº£ vá» táº¥t cáº£ cÃ¡c giÃ¡ trá»‹ trong khoáº£ng 7 8 9

Â 
Â 

MongoDB BÃ i 12 - CÃ¡ch Truy Váº¥n TÃ i Liá»‡u Qua Máº£ng


Â 	VD:
Â 		Giáº£ sá»­ ta cÃ³ 1 máº£ng genres
Â 
Â 		.  db.books.find({"genre": "Fantasy"}) > tÃ¬m máº£ng nÃ o cÃ³ thá»ƒ loáº¡i bÃªn trong

Â 		.  db.books.find({"genre": ["Fantasy"]}) > máº£ng chá»‰ cÃ³ duy nháº¥t thá»ƒ loáº¡i nÃ y bÃªn trong


Â 	2.  $all


Â 		. db.books.find({"genre": {$all: ["1", "2"]}}) > tÃ¬m táº¥t cáº£ cÃ¡c máº£ng cÃ³ Ã­t nháº¥t 2 giÃ¡ trá»‹ nÃ y trá»Ÿ lÃªn

Â 


MongoDB BÃ i 13 - CÃ¡ch Xuáº¥t VÃ  XÃ³a TÃ i Liá»‡u
Â 
Â 	1. Xuáº¥t tÃ i liá»‡u

Â 		MongoDB Compass > chá»n bá»™ sÆ°u táº­p > export data > export full collection


Â 

MongoDB BÃ i 14 - CÃ¡ch Cáº­p Nháº­t TÃ i Liá»‡u

Â 
Â 	1. $set
Â 
Â 		1. db.collection.updateOne({attr}, {$set: {new_attr}}) > update 1 attr

Â 		2. 1. db.collection.updateMany({attr}, {$set: {new_attr}}) > update nhiá»u attr

Â 
Â 	2. $inc > tÄƒng giÃ¡ trá»‹

Â 		1. db.collection.updateOne({attr}, {$inc: {page: 2}}) > tÄƒng thÃªm 2 giÃ¡ trá»‹ , -2 giáº£m 2 giÃ¡ trá»‹


Â 	3. $pull (láº¥y ra), $push (Ä‘áº©y vÃ o) > sá»­ dá»¥ng cho máº£ng


Â 		1. db.collection.updateOne({attr}, {$pull: {genre: "ab"}}) > láº¥y ra 1 pháº§n tá»­,  $push: thÃªm vÃ o 1 pháº§n tá»­




MongoDB BÃ i 15 - CÃ¡ch Káº¿t Ná»‘i Vá»›i NgÃ´n Ngá»¯ Láº­p TrÃ¬nh (Node.js)

Â 
Â 	npm i mongodb --save



MongoDB BÃ i 16 - Káº¿t Ná»‘i VÃ  Gá»i CÆ¡ Sá»Ÿ Dá»¯ Liá»‡u Báº±ng Node.js

Â 	// DB.JS

const { MongoClient } = require("mongodb"); // import MongoClient tá»« thÆ° viá»‡n mongodb
require("dotenv").config(); // Ä‘á»c biáº¿n mÃ´i trÆ°á»ng tá»« file .env

let dbConnection; // biáº¿n toÃ n cá»¥c Ä‘á»ƒ lÆ°u connection sau khi káº¿t ná»‘i

module.exports = {
Â  connectToDB: async (callback) => { // hÃ m káº¿t ná»‘i MongoDB, nháº­n callback bÃ¡o tráº¡ng thÃ¡i
Â    const uri = process.env.MONGO_URI || "mongodb://localhost:27017"; // URL káº¿t ná»‘i MongoDB (Æ°u tiÃªn láº¥y tá»« .env)
Â    const dbName = process.env.DB_NAME || "bookstore"; // tÃªn database (Æ°u tiÃªn láº¥y tá»« .env)

Â    try {
Â      // Táº¡o káº¿t ná»‘i tá»›i MongoDB
Â      const client = await MongoClient.connect(uri, {
Â        useNewUrlParser: true, // cÃº phÃ¡p má»›i cho URL
Â        useUnifiedTopology: true, // dÃ¹ng engine má»›i cá»§a MongoDB driver
Â        serverSelectionTimeoutMS: 5000, // timeout 5 giÃ¢y náº¿u khÃ´ng káº¿t ná»‘i Ä‘Æ°á»£c
Â      });

Â      dbConnection = client.db(dbName); // gÃ¡n káº¿t ná»‘i DB cho biáº¿n toÃ n cá»¥c
Â      console.log(`âœ… Connected to MongoDB database: ${dbName}`); // log thÃ nh cÃ´ng
Â      callback(); // bÃ¡o cho server.js biáº¿t lÃ  káº¿t ná»‘i xong
Â    } catch (error) {
Â      console.error("âŒ Failed to connect to MongoDB:", error.message); // log lá»—i
Â      callback(error); // bÃ¡o lá»—i vá» server.js
Â    }
Â  },

Â  getDB: () => dbConnection, // hÃ m tráº£ vá» connection Ä‘Ã£ lÆ°u Ä‘á»ƒ cÃ¡c file khÃ¡c dÃ¹ng
};


// server.js

const express = require("express"); // import Express
const { connectToDB, getDB } = require("./db"); // import hÃ m connectToDB vÃ  getDB tá»« db.js
require("dotenv").config(); // Ä‘á»c biáº¿n mÃ´i trÆ°á»ng tá»« file .env

const app = express(); // khá»Ÿi táº¡o app Express
const port = process.env.PORT || 3000; // láº¥y port tá»« .env, náº¿u khÃ´ng cÃ³ thÃ¬ dÃ¹ng 3000
let db; // biáº¿n lÆ°u database connection

// Káº¿t ná»‘i DB trÆ°á»›c khi start server
connectToDB((error) => {
Â  if (!error) { // náº¿u khÃ´ng cÃ³ lá»—i káº¿t ná»‘i
Â    db = getDB(); // láº¥y káº¿t ná»‘i DB Ä‘Ã£ lÆ°u trong db.js

Â    app.listen(port, () => { // start server
Â      console.log(`ðŸš€ Server running on port ${port}`);
Â    });
Â  } else {
Â    console.error("âŒ Could not start server because DB connection failed."); // log lá»—i náº¿u káº¿t ná»‘i tháº¥t báº¡i
Â  }
});

// Route GET cÆ¡ báº£n
app.get("/", (req, res) => {
Â  res.send("Hello World!"); // tráº£ vá» text khi truy cáº­p /
});




MongoDB BÃ i 17 - CÃ¡ch Truy Váº¥n Dá»¯ Liá»‡u Báº±ng Node.js

/// CÃCH TRUY Váº¤N CÅ¨NG Gáº¦N Gáº¦N GIá»NG NHÆ¯ CÃCH TRUY Váº¤N QUA CMD cá»§a mongoDB Shell



// Route GET cÆ¡ báº£n
app.get("/books", (req, res) => {
Â  let books = [];
Â  db.collection("books")
Â    .find()
Â    .forEach((book) => {
Â      books.push(book);
Â    })
Â    .then(() => {
Â      res.status(200).json(books);
Â    });
});


// Truy váº¥n qua Id

app.get("/books/:id", (req, res) => {
Â  if (ObjectId.isValid(req.params.id)) {
Â    //
Â  }
});


// POST Insert

Â 	db.collection("books").insertOne(data)

// delete hay update cÅ©ng tÆ°Æ¡ng tá»±


// .skip().limit() > skip vÃ  giá»›i háº¡n sá»‘ lÆ°á»£ng hiá»ƒn thá»‹




MongoDB BÃ i 24 - Chá»‰ Sá»‘ Trong MongoDB

ðŸ“Œ TÃ¡c dá»¥ng chÃ­nh cá»§a createIndex:

TÄƒng tá»‘c Ä‘á»™ truy váº¥n (find, sort, aggregate)

Thay vÃ¬ pháº£i duyá»‡t qua toÃ n bá»™ document trong collection (full collection scan), MongoDB sáº½ dÃ¹ng index Ä‘á»ƒ tÃ¬m dá»¯ liá»‡u nhanh hÆ¡n, giá»‘ng nhÆ° tra cá»©u má»¥c lá»¥c trong sÃ¡ch thay vÃ¬ Ä‘á»c háº¿t cáº£ quyá»ƒn.

Tá»‘i Æ°u sáº¯p xáº¿p (sort)

Náº¿u sáº¯p xáº¿p (sort) theo má»™t field Ä‘Ã£ Ä‘Æ°á»£c táº¡o index, MongoDB cÃ³ thá»ƒ tráº£ káº¿t quáº£ nhanh mÃ  khÃ´ng pháº£i load toÃ n bá»™ dá»¯ liá»‡u vÃ o bá»™ nhá»› Ä‘á»ƒ sáº¯p xáº¿p.

Há»— trá»£ tÃ¬m kiáº¿m phá»©c táº¡p

CÃ³ thá»ƒ táº¡o index trÃªn nhiá»u field (compound index) hoáº·c index Ä‘áº·c biá»‡t nhÆ° text index, geo index, hashed index Ä‘á»ƒ há»— trá»£ tÃ¬m kiáº¿m toÃ n vÄƒn (full-text search), tÃ¬m kiáº¿m vá»‹ trÃ­ Ä‘á»‹a lÃ½, hoáº·c phÃ¢n vÃ¹ng dá»¯ liá»‡u.
Â 


Â 	1. db.collection.createIndex(data) > táº¡o index theo 1 tiÃªu chÃ­ nháº¥t Ä‘á»‹nh

Â 	2. db.collection.getIndexes() > xem toÃ n bá»™ index hiá»‡n táº¡i

Â 	3. db.books.dropIndex(data) > xÃ³a index


Â 	4. db.books.explain("executionStatus") > kiá»ƒm tra index,.. cÃ¡c thÃ´ng sá»‘ khÃ¡c cá»§a data




MongoDB BÃ i 25 - CÃ´ng Cá»¥ MongoDB Atlas


Â 	+ MongoDB Atlas lÃ  dá»‹ch vá»¥ MongoDB trÃªn ná»n táº£ng cloud do chÃ­nh MongoDB Inc. cung cáº¥p.

Â 	+ Hiá»ƒu Ä‘Æ¡n giáº£n, nÃ³ giÃºp báº¡n khÃ´ng cáº§n tá»± cÃ i Ä‘áº·t vÃ  quáº£n lÃ½ server MongoDB, mÃ  váº«n cÃ³ thá»ƒ sá»­ dá»¥ng Ä‘áº§y Ä‘á»§ tÃ­nh nÄƒng cá»§a MongoDB á»Ÿ báº¥t ká»³ Ä‘Ã¢u cÃ³ internet.



Â 	> CÅ©ng giá»‘ng nhÆ° viá»‡c ta deploy Ä‘b lÃªn digital ocean nhá»¯ng dá»… dÃ ng vÃ  Ä‘á»¡ phá»©c táº¡p hÆ¡n nhiá»u

Â 


.................................................................

Â 	Pháº§n 2: Cá»§a lÃ£o khÃ¡c

1. Sá»­ dá»¥ng mongo vá»›i docker  > https://hub.docker.com/_/mongo



2. Schema Validation

Â 	> Sinh ra nháº±m validate cho cÃ¡c collection
Â 
Â 	> CÃ³ ráº¥t nhiá»u thuá»™c tÃ­nh khÃ¡c ná»¯a cá»© tá»« tá»« mÃ  tÃ¬m hiá»ƒu

Â 	VD:

db.createCollection("course", {
Â  validator: {
Â    $jsonSchema: {
Â      bsonType: "object",
Â      title: "Validate Course Object",
Â      properties: {
Â        title: {
Â          bsonType: "string",
Â          description: "title must be a string"
Â        },
Â        hour: {
Â          bsonType: "int",
Â          description: "hour must be a number"
Â        }
Â      }
Â    }
Â  }
})


Â 	/// Show schema info
Â 
Â 	. db.getCollectionInfos({name: "course"}) > láº¥y thÃ´ng tin collection vÃ  validation info

Â 
Â 	/// Update schema validation

db.runCommand({
Â  collMod: "course",
Â  validator: {
Â      $jsonSchema: {
Â      bsonType: "object",
Â      title: "Validate Course Object",
Â      properties: {
Â        title: {
Â          bsonType: "string",
Â          description: "title must be a string"
Â        },
Â        hour: {
Â          bsonType: "int",
Â          description: "hour must be a number"
Â        }
Â      }
Â    }
Â  }
})


3. db.movies.distinct("title") > tÃ¬m báº£n ghi k trÃ¹ng nhau

4. db.movies.find({ directors: {$size: 1}}).count() > Ä‘á»™ dÃ i cá»§a máº£ng


5. Skip, Limit => Paging

Â 	db.movies.find().skip(0).limit(5) > skip vÃ  limit pháº§n tá»­


6. Aggregate Pipeline


Â + Trong MongoDB, khi lÃ m viá»‡c vá»›i mongosh, khÃ¡i niá»‡m aggregate (hay aggregation) dÃ¹ng Ä‘á»ƒ chá»‰ quÃ¡ trÃ¬nh xá»­ lÃ½ vÃ  biáº¿n Ä‘á»•i dá»¯ liá»‡u tá»« cÃ¡c document trong collection Ä‘á»ƒ táº¡o ra káº¿t quáº£ tá»•ng há»£p theo má»™t pipeline (chuá»—i cÃ¡c bÆ°á»›c xá»­ lÃ½).

ðŸ‘‰ NÃ³i cÃ¡ch khÃ¡c: aggregate giá»‘ng nhÆ° viá»‡c báº¡n viáº¿t má»™t â€œquery nÃ¢ng caoâ€ Ä‘á»ƒ:

Lá»c dá»¯ liá»‡u ($match)

Gom nhÃ³m ($group)

Sáº¯p xáº¿p ($sort)

TÃ­nh toÃ¡n (sum, avg, countâ€¦)

Biáº¿n Ä‘á»•i dá»¯ liá»‡u ($project, $lookup, â€¦)


Â 	> CÃ¡c stage (bÆ°á»›c) phá»• biáº¿n trong aggregation pipeline:

$match â†’ lá»c document (giá»‘ng find)

$group â†’ nhÃ³m dá»¯ liá»‡u theo _id

$sort â†’ sáº¯p xáº¿p káº¿t quáº£

$project â†’ chá»n/trÃ­ch xuáº¥t/trÃ¡nh hiá»ƒn thá»‹ cÃ¡c trÆ°á»ng

$lookup â†’ join vá»›i collection khÃ¡c

$limit, $skip â†’ phÃ¢n trang

$count, $sum, $avg, $min, $max â†’ cÃ¡c toÃ¡n tá»­ tÃ­nh toÃ¡n


Â 	VD: lá»c lá»›n hÆ¡n 2000 > sáº¯p xáº¿p nhá» Ä‘áº¿n lá»›n > lá»c chá»‰ láº¥y year vÃ  _id

db.movies.aggregate([
Â  {
Â    $match : {
Â      year: {$gt:  2000}
Â    }
Â  },
Â  {
Â    $sort: {year: 1}
Â  },
Â  {
Â    $project: {year: 1}
Â  }
])


Â      VD: tÃ­nh trung bÃ¬nh

{ "name": "Alice", "subject": "Math", "score": 85 }
{ "name": "Bob", "subject": "Math", "score": 92 }
{ "name": "Alice", "subject": "History", "score": 78 }
{ "name": "Bob", "subject": "History", "score": 88 }


db.students.aggregate([
Â  { $group: { _id: "$name", avgScore: { $avg: "$score" } } }
])


> { "\_id": "Alice", "avgScore": 81.5 }
Â  { "_id": "Bob", "avgScore": 90 }


/////////

KhÃ¡i niá»‡m $lookup

$lookup dÃ¹ng Ä‘á»ƒ káº¿t há»£p dá»¯ liá»‡u tá»« 2 collection khÃ¡c nhau trong MongoDB.

NÃ³ hoáº¡t Ä‘á»™ng giá»‘ng nhÆ° LEFT JOIN trong SQL.

Káº¿t quáº£ sau khi $lookup sáº½ thÃªm má»™t máº£ng chá»©a dá»¯ liá»‡u "match" tá»« collection kia.


Â 	Cáº¥u trÃºc :

{
Â  $lookup: {
Â    from: "<collection khÃ¡c>",        // tÃªn collection cáº§n join
Â    localField: "<trÆ°á»ng á»Ÿ collection hiá»‡n táº¡i>",
Â    foreignField: "<trÆ°á»ng á»Ÿ collection Ä‘Æ°á»£c join>",
Â    as: "<tÃªn field má»›i Ä‘á»ƒ lÆ°u káº¿t quáº£>"
Â  }
}



Â 	VD: join 2 collection vá»›i $lookup

Â 
{ "_id": 1, "item": "apple", "customerId": 101 }
{ "_id": 2, "item": "banana", "customerId": 102 }
{ "_id": 3, "item": "orange", "customerId": 103 }


{ "_id": 101, "name": "John" }
{ "_id": 102, "name": "Mary" }



db.orders.aggregate([
Â  {
Â    $lookup: {
Â      from: "customers",       // join vá»›i collection customers
Â      localField: "customerId",// field trong orders
Â      foreignField: "_id",     // field trong customers
Â      as: "customerInfo"       // Ä‘áº·t tÃªn field má»›i Ä‘á»ƒ chá»©a dá»¯ liá»‡u join
Â    }
Â  }
])


> Káº¿t quáº£ 

{
Â  "_id": 1,
Â  "item": "apple",
Â  "customerId": 101,
Â  "customerInfo": [ { "_id": 101, "name": "John" } ]
}
{
Â  "_id": 2,
Â  "item": "banana",
Â  "customerId": 102,
Â  "customerInfo": [ { "_id": 102, "name": "Mary" } ]
}
{
Â  "_id": 3,
Â  "item": "orange",
Â  "customerId": 103,
Â  "customerInfo": [ ]   // khÃ´ng tÃ¬m tháº¥y => máº£ng rá»—ng
}


Â 

7. LÃ m viá»‡c vá»›i REGular EXpression (Biáº¿u thá»©c chÃ­nh quy)

VD: regex cÃ³ chá»©a kÃ­ tá»± trong 1 chuá»—i

db.comments.aggregate([
Â  {
Â   $match: {
Â    text: /.*Veritatis.*/i
Â  }
Â  }
])



8. $addFields : ThÃªm trÆ°á»ng vÃ o káº¿t quáº£

db.movies.aggregate([
Â  {
Â    $match: {
Â      writers: {$exists: true}
Â    }
Â  },
Â  {
Â  $addFields: {
Â    numberOfWriter: {$size: "$writers"},
Â    numberOfAward:  "$awards.wins"
Â  }
Â  }
])



9. $unwind: lÃ m pháº³ng 1 máº£ng thÃ nh nhiá»u obj riÃªng láº»

VD:


{ "_id": 1, "name": "Alice", "hobbies": ["reading", "coding", "swimming"] }
{ "_id": 2, "name": "Bob",   "hobbies": ["gaming", "traveling"] }


db.students.aggregate([
Â  { $unwind: "$hobbies" }
])


> káº¿t quáº£ 


{ "_id": 1, "name": "Alice", "hobbies": "reading" }
{ "_id": 1, "name": "Alice", "hobbies": "coding" }
{ "_id": 1, "name": "Alice", "hobbies": "swimming" }
{ "_id": 2, "name": "Bob",   "hobbies": "gaming" }
{ "_id": 2, "name": "Bob",   "hobbies": "traveling" }








Â 

Â 